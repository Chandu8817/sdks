import { ethers } from "ethers";

import { SignedOrder } from "../dist/src/utils/OrderQuoter";

import { REACTOR_ADDRESS_MAPPING } from "./constants";
import { DutchLimitOrder } from "./order/DutchLimitOrder";
import { EventWatcher, OrderValidator } from "./utils";

const provider = new ethers.providers.JsonRpcProvider(
  "https://eth-mainnet.g.alchemy.com/v2/DcaPigsOw6210NnbsGOFIC09LTJurBp-"
);

const watcher = new EventWatcher(
  provider,
  REACTOR_ADDRESS_MAPPING[1].DutchLimit
);

// const quoter = new OrderQuoter(provider, 1, ORDER_QUOTER_MAPPING[1]);
const validator = new OrderValidator(provider, 1);

async function main() {
  await watcher.getFillInfo(16742185, 16742190);

  const parsed = DutchLimitOrder.parse(
    "0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000640624e80000000000000000000000000000000000000000000000000000000064062506000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480000000000000000000000000000000000000000000000000000000005f5e1000000000000000000000000000000000000000000000000000000000005f5e100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000081f570f48be8d3d358404f257b5bdc4a88eefa500000000000000000000000003bee7cd3bbd61b1b6681e35c3bde5a588d81c30a046832c86fdd39e38b5fd0900ea6ee2e79adeb6a2605e226089afd65503eae0100000000000000000000000000000000000000000000000000000000640625060000000000000000000000008a66a74e15544db9688b68b06e116f5d19e5df9000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a6ceafed2fda17365148a7a42291aadba10caced00000000000000000000000000000000000000000000000000000000640624d700000000000000000000000000000000000000000000000000000000000000010000000000000000000000006b175474e89094c44da98b954eedeac495271d0f0000000000000000000000000000000000000000000000051cd05de50e0c4000000000000000000000000000000000000000000000000004db5f8c6666f209990000000000000000000000003bee7cd3bbd61b1b6681e35c3bde5a588d81c30a0000000000000000000000000000000000000000000000000000000000000000",
    1
  );
  console.log(JSON.stringify(parsed, null, 2));

  const sig =
    "0x9e4944d004ec03133789237150ceb37ceb65bef3e93a117e227b56da4c34071f51cd647506d8d98fe4ae7e9141963de2915972d25ad92471ce003474d2c8371a1c";

  const signed: SignedOrder = {
    order: parsed,
    signature: sig,
  };

  // const quote = quoter.quoteBatch([signed]);
  // console.log(JSON.stringify(quote, null, 2));

  const validation = await validator.validate(signed);
  console.log(JSON.stringify(validation, null, 2));
}

main().then();
